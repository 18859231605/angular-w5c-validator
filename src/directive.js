(function(){    angular.module("w5c.validator").directive("test", ['$timeout', '$http', function ($timeout, $http) {        return{            require: "ngModel",            link: function (scope, elem, attrs, ngModel) {                var doValidate = function () {                    var attValues = scope.$eval(attrs.w5cUniqueCheck);                    var url = attValues.url;                    var isExists = attValues.isExists;//default is true                    $http.get(url).success(function (result) {                        if (isExists === false) {                            ngModel.$setValidity('w5cuniquecheck', result.data);                        }                        else {                            ngModel.$setValidity('w5cuniquecheck', !result.data);                        }                    });                };                scope.$watch(attrs.ngModel, function (newValue) {                    if (_.isEmpty(newValue)) {                    } else if (!scope[elem[0].form.name][elem[0].name].$dirty) {                        doValidate();                    }                });                elem.bind("blur", function () {                    $timeout(function () {                        if (scope[elem[0].form.name][elem[0].name].$invalid) {                            return;                        }                        doValidate();                    });                });                elem.bind("focus", function () {                    $timeout(function () {                        ngModel.$setValidity('w5cuniquecheck', true);                    });                });            }        };    }]);})();